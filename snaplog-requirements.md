# SnapLog 要件定義書

## 1. 概要

### 1.1 プロジェクト名
SnapLog

### 1.2 目的
日報の素材収集を自動化し、1日の作業内容を振り返る負担をゼロにする。

### 1.3 コンセプト
- Macでバックグラウンド常駐するPythonスクリプト
- 定期的に画面をキャプチャしてOCRでテキスト化
- ログを蓄積し、ローカルLLMで日報を生成
- すべてローカルで完結（外部API課金なし）

---

## 2. 機能要件

### 2.1 画面キャプチャ機能

| 項目 | 内容 |
|------|------|
| キャプチャ対象 | 画面全体 |
| 取得情報 | スクリーンショット画像、アクティブウィンドウ名、アプリ名 |
| 一時保存先 | `/tmp/`（処理後に即削除） |

### 2.2 OCR機能

| 項目 | 内容 |
|------|------|
| 使用技術 | macOS Vision Framework（ローカル処理） |
| 対応言語 | 日本語・英語 |
| 精度 | 完璧でなくてOK（文脈が分かれば十分） |

### 2.3 除外機能（プライバシー保護）

3段階のフィルタリングでプライバシーを保護する。

| レイヤー | 判定タイミング | 例 |
|----------|---------------|-----|
| アプリ名 | キャプチャ前 | 1Password, キーチェーンアクセス |
| ウィンドウタイトル | キャプチャ前 | 「クレジットカード」「銀行」を含むタイトル |
| OCR結果 | キャプチャ後 | クレカ番号パターン、電話番号パターン |

除外条件に該当した場合、そのキャプチャは保存せず破棄する。

### 2.4 ログ保存機能

| 項目 | 内容 |
|------|------|
| 形式 | JSONL（1行1レコード） |
| ファイル名 | `activity_log_YYYY-MM-DD.jsonl`（日付別） |
| 保存先 | `~/Documents/SnapLog/logs/` |

#### JSONLレコード構造

```json
{
  "timestamp": "2025-01-15T14:32:00+09:00",
  "app_name": "Cursor",
  "window_title": "main.py - MyProject",
  "ocr_text": "def capture_screen():..."
}
```

### 2.5 日報生成機能（Phase 2）

| 項目 | 内容 |
|------|------|
| 実行タイミング | 手動（コマンド実行） |
| LLM | ローカルLLM（LM Studio or Ollama） |
| 入力 | 当日のJSONLファイル |
| 出力 | Markdown形式の日報 |
| 出力先 | `~/Documents/SnapLog/reports/` |

---

## 3. 非機能要件

### 3.1 設定可能な項目

| 設定項目 | デフォルト値 | 備考 |
|----------|-------------|------|
| キャプチャ間隔 | 60秒 | 秒単位で変更可能 |
| 除外アプリリスト | 1Password, キーチェーンアクセス | 追加・削除可能 |
| 除外キーワード | 銀行, クレジットカード | ウィンドウタイトル用 |
| 除外パターン | クレカ番号の正規表現等 | OCR結果用 |
| ログ保存先 | ~/Documents/SnapLog/ | 変更可能 |

### 3.2 動作環境

| 項目 | 内容 |
|------|------|
| OS | macOS（Ventura以降推奨） |
| Python | 3.10以上 |
| 必須ライブラリ | pyobjc-framework-Vision |

### 3.3 リソース効率

| 項目 | 方針 |
|------|------|
| スクショ画像 | OCR完了後に即削除（保持しない） |
| 一時ファイル | `/tmp/` に保存（OS再起動で自動消去） |
| メモリ | 画像は処理中のみ保持 |
| CPU | キャプチャ・OCR時のみ負荷、待機中はほぼゼロ |

---

## 4. 技術スタック

| レイヤー | 技術 |
|----------|------|
| 言語 | Python 3.10+ |
| スクリーンキャプチャ | macOS `screencapture` コマンド |
| ウィンドウ情報取得 | AppleScript via subprocess |
| OCR | macOS Vision Framework (pyobjc) |
| データ保存 | JSONL（標準ライブラリ） |
| 日報生成 | LM Studio or Ollama |
| 定期実行 | launchd or Python内ループ |
| 設定管理 | YAML or JSON |

---

## 5. 想定される主な利用シーン

| 作業 | アプリ | 取得される情報 |
|------|--------|---------------|
| 開発 | Cursor | コード、ファイル名、エラーメッセージ |
| 執筆 | Cursor | 記事タイトル、見出し、本文 |
| 読書 | Kindle等 | 書籍タイトル、読んでいる箇所 |
| AI対話 | ChatGPT, Claude | 質問内容、回答の要点 |

---

## 6. 開発フェーズ

### Phase 1：素材収集（MVP）
- [ ] スクリーンキャプチャ機能
- [ ] アクティブウィンドウ情報取得
- [ ] Vision Framework OCR
- [ ] JSONL保存
- [ ] 除外機能（アプリ名）

### Phase 2：日報生成
- [ ] ローカルLLM連携
- [ ] 日報テンプレート作成
- [ ] Markdown出力

### Phase 3：改善
- [ ] 除外機能強化（ウィンドウタイトル、OCRパターン）
- [ ] 設定ファイル対応（YAML）
- [ ] メニューバーUI（オプション）

---

## 7. 未決定事項

- 日報のフォーマット・項目（Phase 2で検討）
- ログの保持期間（何日分残すか）
- アプリごとのキャプチャ間隔変更（必要性を検討）

---

## 8. 補足：システム構成図

```
┌─────────────────────────────────────────────────┐
│                    Mac                          │
│                                                 │
│  ┌───────────────────────────────────────────┐  │
│  │  SnapLog（バックグラウンド常駐）            │  │
│  │                                           │  │
│  │  [毎分実行]                                │  │
│  │   1. screencapture → /tmp/screenshot.png  │  │
│  │   2. AppleScript → アプリ名・ウィンドウ名  │  │
│  │   3. Vision OCR → テキスト抽出            │  │
│  │   4. 除外判定 → 該当すれば破棄            │  │
│  │   5. JSONL に追記                         │  │
│  │   6. 画像削除                             │  │
│  └───────────────────────────────────────────┘  │
│                      ↓                          │
│  ┌───────────────────────────────────────────┐  │
│  │  ~/Documents/SnapLog/logs/                │  │
│  │    └─ activity_log_2025-01-15.jsonl       │  │
│  └───────────────────────────────────────────┘  │
│                      ↓                          │
│  ┌───────────────────────────────────────────┐  │
│  │  日報生成スクリプト（手動実行）            │  │
│  │   1. 当日のJSONL読み込み                  │  │
│  │   2. ローカルLLM（LM Studio/Ollama）      │  │
│  │   3. 日報Markdown出力                     │  │
│  └───────────────────────────────────────────┘  │
│                      ↓                          │
│  ┌───────────────────────────────────────────┐  │
│  │  ~/Documents/SnapLog/reports/             │  │
│  │    └─ report_2025-01-15.md                │  │
│  └───────────────────────────────────────────┘  │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

*作成日: 2025年1月*
*バージョン: 1.0*
