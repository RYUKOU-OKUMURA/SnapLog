# SnapLog 設定ファイル

# ===== 基本設定 =====
capture:
  interval: 60                    # キャプチャ間隔（秒）
  mode: "active_window"           # fullscreen / active_window（アクティブウィンドウのみ）
  temp_dir: "/tmp"                # 一時ファイル保存先

# ===== 保存先 =====
storage:
  base_dir: "/Users/ryukouokumura/マイドライブ（okumura@physical-balance-lab.net）/Obsidian Vault/SnapLog"
  log_subdir: "logs"
  report_subdir: "reports"
  retention_days: 14              # 保持日数
  cleanup_on_start: true          # 起動時に古いファイルを削除

# ===== 除外設定 =====
filter:
  # 許可リスト（allowlist）: このリストが空でない場合、リストに含まれるアプリのみ記録
  # 例: 開発作業のみ記録したい場合
  # allow_apps:
  #   - "Cursor"
  #   - "Visual Studio Code"
  #   - "Terminal"
  
  # 除外するアプリ名（完全一致）
  exclude_apps:
    - "1Password"
    - "1Password 7"
    - "Keychain Access"
    - "キーチェーンアクセス"
    - "Bitwarden"
  
  # 除外するウィンドウタイトル（部分一致）
  exclude_title_keywords:
    - "銀行"
    - "Bank"
    - "クレジットカード"
    - "Credit Card"
    - "パスワード"
    - "Password"
    - "ログイン"
    - "Sign in"
  
  # 除外するOCRパターン（正規表現）
  exclude_patterns:
    # クレジットカード番号（4桁×4）
    - '\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}'
    # 電話番号
    - '\d{2,4}-\d{2,4}-\d{4}'
    # マイナンバー
    - '\d{4}[-\s]?\d{4}[-\s]?\d{4}'
  
  # 除外判定のログを残すかどうか（プライバシー強化: false推奨）
  log_exclusion_reason: false

  # 重複検出の閾値（0.0-1.0）: この値以上の類似度なら重複とみなす
  # デフォルト0.9では微細な差（タイムスタンプ等）で通過するため0.7に下げる
  similarity_threshold: 0.7

  # UIノイズ除去パターン（正規表現）: マッチした行を削除
  ui_noise_patterns:
    # === 基本パターン ===
    # 日本語メニュー項目
    - "^(ファイル|編集|表示|選択|移動|実行|ターミナル|ウィンドウ|ヘルプ|アシスタント|履歴|ブックマーク|プロファイル|タブ)$"
    # 日付時刻表示
    - "^\\d+月\\d+日（[日月火水木金土]）\\s*\\d+:\\d+$"
    # 英語メニュー
    - "^[A-Z][a-z]+\\s+(File|Edit|View|Window|Help)$"
    # アプリ名単独
    - "^(Cursor|Comet|SnapLog|YouTube|Claude Code|Facebook|Google)$"
    # 短い記号・無意味な文字
    - "^[X★⑨②Q\\+\\-×n山くの]{1,3}$"
    - "^[0-9]{2,3}$"
    # UI定型文
    - "^(いつもの|もっと見る|新着|開始する|（アシスタント|タグ・説明付き)$"
    - "^[<>]\\s*(Continue|タイムライン|アウトライン)"
    # JSONフラグメント
    - "^[f\"]?(timestamp|app_name|window_title|ocr_text|ocr_length)\"?[：:｜|]"
    - "^\"(Comet|Cursor|cursor)\"[，,]$"
    # Cursor/IDE固有
    - "^(Plan，|Codex|Git Graph|Composer|Agent)$"
    - "^\\d+\\s*(main|maint)\\*?\\s*"

    # === 追加パターン（サイドバー・UI要素）===
    # サイドバーのファイル/ディレクトリ名
    - "^[>■◎●♥]*\\s*_?[a-zA-Z_-]+$"
    - "^[>■◎●♥]*\\s*\\.[a-zA-Z]+$"
    - "^[>■◎●♥]*\\s*[a-zA-Z_-]+\\.(py|md|txt|yaml|json|ts|js)$"
    # Cursor/IDE UI要素
    - "^@\\s*You've used.*usage limit"
    - "^Plan，\\s*@\\s*for context"
    - "^Review Next File$"
    - "^スクリーン\\s*リーダー"
    - "^\\*.*変更済み$"
    - "^Composer.*"
    - "^Agent.*"
    - "^Past (Chats|Conversations).*"
    - "^View All$"
    - "^Loading$"
    - "^Thinking.*"
    - "^Edit (failed|automatically)"
    - "^Tool interrupted$"
    # キャプチャ系ノイズ
    - "^(pycache|pytest_cache|build|config|venv|src|resources)$"
    - "^\\d+[→]"

# ===== LLM設定（Phase 2）=====
llm:
  # LM Studioの場合
  endpoint: "http://localhost:1234/v1/chat/completions"
  # Ollamaの場合
  # endpoint: "http://localhost:11434/v1/chat/completions"
  model: "google/gemma-3-27b"     # Gemma 3 27B（128Kコンテキスト対応）
  max_tokens: 4000                # 出力トークン数（日報には十分）
  timeout: 300                    # タイムアウト（秒）- 27Bモデルは推論に時間がかかる

# ===== 日報生成（Phase 2）=====
report:
  group_gap_minutes: 10           # 10分以上の空きでセッション分割
  chunk_chars: 6000               # LLM投入用の分割（LM Studioのデフォルト設定に対応）
  add_timestamp: true             # ファイル名に時刻を付与して複数生成を許可
  timestamp_format: "%H-%M-%S"    # 例: 21-35-02

# ===== ログ設定 =====
logging:
  level: "ERROR"                  # DEBUG, INFO, WARNING, ERROR
  file: "/Users/ryukouokumura/マイドライブ（okumura@physical-balance-lab.net）/Obsidian Vault/SnapLog/logs/app.log"
